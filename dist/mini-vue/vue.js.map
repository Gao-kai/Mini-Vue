{"version":3,"file":"vue.js","sources":["../../src/observer/dep.js","../../src/observer/index.js","../../src/observer/proxy.js","../../src/init/initData.js","../../src/init/initState.js","../../src/template-compiler/tagRegs.js","../../src/template-compiler/htmlParser.js","../../src/template-compiler/index.js","../../src/observer/nextTick.js","../../src/observer/watcher.js","../../src/lifecycle/index.js","../../src/init/init.js","../../src/vNode/index.js","../../src/lifecycle/initLifeCycle.js","../../src/index.js"],"sourcesContent":["let id = 0;\r\n// 属性的dep核心目的：收集watcher 也称之为属性的收集器\r\nclass Dep {\r\n\tconstructor() {\r\n\t    this.id = id++; \r\n\t    this.subs = []; // 存放着当前属性对应的watcher都有哪些\r\n\t}\r\n\t\r\n\t/**\r\n\t * \r\n\t * @param {Object} watcher\r\n\t */\r\n\tdepend(watcher){\r\n\t\t// 让watcher先记住dep 比直接push实现去重 这个this是dep\r\n\t\twatcher.addDep(this);\r\n\t\t\r\n\t\t// 直接在这里无脑push 不会去重\r\n\t\t// this.subs.push(watcher);\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {Object} watcher\r\n\t * 给属性的dep收集器记录收集了多少个watcher\r\n\t * 其实就是记录这个属性有多少个组件模板在引用\r\n\t */\r\n\taddSub(watcher){\r\n\t\t this.subs.push(watcher);\r\n\t}\r\n\t\r\n\t/**\r\n\t * 通知当前dep收集的watcher更新视图\r\n\t */\r\n\tnotify(){\r\n\t\tthis.subs.forEach(watcher=>{\r\n\t\t\twatcher.update();\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// 给Dep挂载一个全局属性 暴露出去 初始值为null 就是一个全局变量\r\nDep.target = null;\r\n\r\n\r\nexport default Dep;","import Dep from './dep.js'\r\n\r\n// 传递过来的是data引用空间\r\nexport function observe(data) {\r\n\tif (typeof data !== 'object' || data === null) return;\r\n\t// 如果一个对象的__ob__属性存在并且是Observer的实例 那么说明这个对象已经被观测过了\r\n\tif (data.__ob__ instanceof Observer) {\r\n\t\treturn data.__ob__;\r\n\t}\r\n\treturn new Observer(data);\r\n}\r\n\r\n// 观测数组和对象的类\r\nclass Observer {\r\n\tconstructor(data) {\r\n\t\t// 让__ob__属性的可被遍历属性设置为false\r\n\t\tObject.defineProperty(data, '__ob__', {\r\n\t\t\tvalue: this,\r\n\t\t\tenumrable: false,\r\n\t\t\tconfigurable: false\r\n\t\t})\r\n\r\n\t\tif (Array.isArray(data)) {\r\n\t\t\tlet newArrayProto = createNewArrayProto();\r\n\t\t\tdata.__proto__ = newArrayProto;\r\n\t\t\t// 会将数组中的对象的属性进行劫持\r\n\t\t\tthis.observeArray(data);\r\n\t\t} else {\r\n\t\t\tthis.walk(data);\r\n\t\t}\r\n\t}\r\n\r\n\twalk(data) {\r\n\t\tObject.keys(data).forEach(key => {\r\n\t\t\t// 单独定义  公共 方便导出 不放在类上\r\n\t\t\tdefineReactive(data, key, data[key]);\r\n\t\t})\r\n\t}\r\n\r\n\tobserveArray(data) {\r\n\t\tdata.forEach(item => {\r\n\t\t\tobserve(item);\r\n\t\t})\r\n\t}\r\n\r\n}\r\n\r\n\r\nfunction defineReactive(target, key, value) {\r\n\t// 递归劫持 如果对象的属性值还是一个对象\r\n\tobserve(value);\r\n\t/**\r\n\t * 每一个属性在defineProperty前都有一个独立的dep\r\n\t * 这个dep由于和defineProperty中的get方法形成闭包\r\n\t * 不会被垃圾回收所销毁\r\n\t */\r\n\tlet dep = new Dep();\r\n\t\r\n\tObject.defineProperty(target, key, {\r\n\t\t// 拦截取值操作\r\n\t\tget() {\r\n\t\t\tconsole.log('取值操作', key, value);\r\n\t\t\t\r\n\t\t\t// 属性的收集器dep 进行依赖收集\r\n\t\t\tif(Dep.target){\r\n\t\t\t\tdep.depend(Dep.target);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\t// 拦截赋值操作\r\n\t\tset(newValue) {\r\n\t\t\tconsole.log('存值操作', key, value);\r\n\t\t\tif (newValue === value) return;\r\n\t\t\t// 如果新赋的值是一个新的对象 还需要劫持\r\n\t\t\tobserve(newValue);\r\n\t\t\tvalue = newValue;\r\n\t\t\t\r\n\t\t\t// 响应式属性值变化 通知此属性dep收集到的watcher更新视图\r\n\t\t\tdep.notify();\r\n\t\t}\r\n\t})\r\n}\r\n\r\n\r\nfunction createNewArrayProto() {\r\n\tlet oldArrayProto = Array.prototype;\r\n\tlet newArrayProto = Object.create(oldArrayProto);\r\n\r\n\t// 以下7个方法会改变原数组\r\n\tlet methods = [\r\n\t\t'push',\r\n\t\t'pop',\r\n\t\t'shift',\r\n\t\t'unshift',\r\n\t\t'sort',\r\n\t\t'reverse',\r\n\t\t'splice'\r\n\t]\r\n\r\n\tmethods.forEach(method => {\r\n\t\tnewArrayProto[method] = function(...args) {\r\n\t\t\tconsole.log('监听到调用了数组方法', method);\r\n\t\t\tlet result = oldArrayProto[method].call(this, ...args);\r\n\r\n\t\t\t// 需要对操作数组方法的时候新增的数据 再次进行劫持\r\n\t\t\tlet inserted;\r\n\t\t\tswitch (method) {\r\n\t\t\t\tcase 'push':\r\n\t\t\t\tcase 'unshift':\r\n\t\t\t\t\tinserted = args;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'splice':\r\n\t\t\t\t\tinserted = args.slice(2);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tconsole.log('inserted', inserted);\r\n\r\n\t\t\tif (inserted) {\r\n\t\t\t\t// 对新增的内容再次进行劫持\r\n\t\t\t\tthis.__ob__.observeArray(inserted);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\t})\r\n\r\n\treturn newArrayProto;\r\n}\n","// 将target对象上的所有\r\n/**\r\n * @param {Object} vm Vue实例对象\r\n * @param {Object} target 要代理的vm上的目标对象_data = {}\r\n * @param {Object} key 目标对象的属性 name\r\n * 实现访问vm.name = 访问vm._data.name\r\n */\r\nexport function proxy(vm, target, key) {\r\n\tObject.defineProperty(vm, key, {\r\n\t\tget() {\r\n\t\t\treturn vm[target][key];\r\n\t\t},\r\n\t\tset(newValue) {\r\n\t\t\tvm[target][key] = newValue;\r\n\t\t}\r\n\t})\r\n}","import {observe} from '../observer/index.js'\r\nimport {proxy} from '../observer/proxy.js'\r\n\r\n/**\r\n * 1. 获取数据\r\n * 2. 对获取到的data进行响应式处理\r\n */\r\nexport function initData(vm) {\r\n\r\n\tlet data = vm.$options.data;\r\n\tdata = typeof data === 'function' ? data.call(vm) : data;\r\n\r\n\t// 将要劫持的对象放在实例上 便于观测效果\r\n\tvm._data = data;\r\n\tobserve(data);\r\n\r\n\t// 数据代理\r\n\tfor (let key in data) {\r\n\t\tproxy(vm, '_data', key);\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n","import {initData} from './initData.js'\r\n\r\nexport function initState(vm) {\r\n\tlet options = vm.$options; // 获取用户传入的选项\r\n\t\r\n\tif (options.props) {\r\n\t\tinitProps(vm);\r\n\t}\r\n\r\n\tif (options.data) {\r\n\t\tinitData(vm);\r\n\t}\r\n\r\n\tif (options.methods) {\r\n\t\tinitMethods(vm);\r\n\t}\r\n\r\n\tif (options.computed) {\r\n\t\tinitComputed(vm);\r\n\t}\r\n\r\n\tif (options.watch) {\r\n\t\tinitWatch(vm);\r\n\t}\r\n}\r\n\r\n","// 匹配解析正则表达式\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\n/**\r\n * 正则startTagOpen用来匹配开始标签的名字\r\n * 1.以<开头\r\n * 2.标签名不能以数字开头，可以使用字母和下划线 <div 自定义标签<_demo\r\n * 3.除了标签名的首字母不可以是字符 第二位可使用数字 <h1\r\n * 4.考虑存在命名空间的标签比如 <namespace:div 虽然很少见\r\n * 5.此正则匹配到的分组是标签名组成的字符串\r\n */\r\nexport const startTagOpen = new RegExp(`^<${qnameCapture}`);\r\n\r\n/**\r\n * 正则startTagClose用来匹配结束标签\r\n * 1.可以有一个/，比如单标签<br/>的结束/>\r\n * 2.可以没有/，比如正常标签的结束>\r\n */\r\nexport const startTagClose = /^\\s*(\\/?)>/;\r\n\r\n/**\r\n * 正则endTag用来匹配结束标签的名字\r\n * 1.以</开头\r\n * 2.匹配到的是</div的标签名组成的字符串\r\n */\r\nexport const endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\r\n\r\n/**\r\n * 正则attribute用来匹配属性\r\n * 1. 属性的前面可以有空白字符，但是不能有特殊字符\r\n * 2. 匹配的属性可以是：color = \"xxx\"\r\n * 3. 匹配的属性可以是：color = 'yyy'\r\n * 4. 匹配的属性可以是：color = zzz\r\n * 5. 此正则匹配到的分组是1分组-属性key 3分组或4分组或5分组-属性value\r\n */\r\nexport const attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\n\r\n/**\r\n * defaultTagReg匹配到的是{{xxx }} 表达式的变量xxx\r\n * \r\n */\r\nexport const defaultTagReg = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n","import {\r\n\tstartTagOpen,\r\n\tstartTagClose,\r\n\tendTag,\r\n\tattribute,\r\n\tdefaultTagReg\r\n} from './tagRegs.js'\r\n\r\nexport const ELEMENT_TYPE = 1;\r\nexport const TEXT_TYPE = 3;\r\n\r\n/**\r\n * 1. 解析html字符串的开头一定是< \r\n * 2. 解析html字符串的原则是每解析一个标签就从html中将其删除\r\n * 3. 直到html截取空了，此时模板就解析完成了\r\n * 4. Vue3.0支持直接在template中写字符串，Vue2.0不行\r\n * 5. 返回值是AST抽象语法树\r\n * \r\n */\r\nexport function parseHTML(htmlStr) {\r\n\r\n\t// 定义创建AST节点所需变量\r\n\tconst stack = [];\r\n\tlet currentParent; // 永远指向栈中最后一个元素的指针\r\n\tlet root;\r\n\r\n\t/**\r\n\t * 创建AST节点\r\n\t */\r\n\tfunction createASTElement(tag, attrs) {\r\n\t\treturn {\r\n\t\t\ttag,\r\n\t\t\ttype: ELEMENT_TYPE,\r\n\t\t\tattrs,\r\n\t\t\tparent: null,\r\n\t\t\tchildren: []\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} tagName\r\n\t * @param {Object} attrs\r\n\t * 根据正则匹配到的开始标签的tagName和attrs构建AST节点\r\n\t */\r\n\tfunction start(tagName, attrs) {\r\n\t\tconsole.log(tagName, attrs, '开始标签');\r\n\r\n\t\tlet astNode = createASTElement(tagName, attrs);\r\n\t\t// 如果root为空 就是AST树的根节点\r\n\t\tif (!root) {\r\n\t\t\troot = astNode;\r\n\t\t}\r\n\r\n\t\tif (currentParent) {\r\n\t\t\tastNode.parent = currentParent;\r\n\t\t\tcurrentParent.children.push(astNode);\r\n\t\t}\r\n\r\n\t\tstack.push(astNode);\r\n\t\tcurrentParent = astNode; // currentParent指向栈中最后一个元素\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} tagName\r\n\t * 根据正则匹配到的结束标签的tagName构建AST节点\r\n\t */\r\n\tfunction end(tagName) {\r\n\t\tconsole.log(tagName, '结束标签');\r\n\t\tlet astNode = stack.pop(); // 栈顶弹出最后一个 校验标签是否合法\r\n\t\tif (astNode.tag !== tagName) {\r\n\t\t\tconsole.error('标签不合法')\r\n\t\t}\r\n\t\tcurrentParent = stack[stack.length - 1]; // 重新指向栈中最后一个\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} text\r\n\t * 根据正则匹配到的文本text构建AST节点\r\n\t */\r\n\tfunction chars(text) {\r\n\t\tconsole.log(text, '文本内容');\r\n\t\ttext = text.replace(/\\s/g, '') // 将多个空格替换为1个\r\n\t\t// 文本直接放到当前指向的节点的children下\r\n\t\ttext && currentParent.children.push({\r\n\t\t\ttext,\r\n\t\t\ttype: TEXT_TYPE,\r\n\t\t\tparent: currentParent\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * 将htmlStr从索引为n的地方截取到末尾 并返回截取后的htmlStr\r\n\t */\r\n\tfunction advance(n) {\r\n\t\thtmlStr = htmlStr.slice(n);\r\n\t}\r\n\r\n\t/**\r\n\t * 根据正则匹配解析开始标签\r\n\t */\r\n\tfunction parseStartTag() {\r\n\t\tconst start = htmlStr.match(startTagOpen);\r\n\t\tconsole.log('匹配开始标签正则的结果', start);\r\n\r\n\t\tif (start) {\r\n\t\t\tconst match = {\r\n\t\t\t\ttagName: start[1], // 捕获到的是标签名\r\n\t\t\t\tattrs: []\r\n\t\t\t}\r\n\t\t\tadvance(start[0].length);\r\n\r\n\t\t\t// 只要不是开始标签的结束就一直匹配 同时记录属性\r\n\t\t\tlet attrResult;\r\n\t\t\tlet endResult;\r\n\t\t\twhile (!(endResult = htmlStr.match(startTagClose)) && (attrResult = htmlStr.match(attribute))) {\r\n\t\t\t\tadvance(attrResult[0].length);\r\n\t\t\t\tmatch.attrs.push({\r\n\t\t\t\t\tname: attrResult[1],\r\n\t\t\t\t\tvalue: attrResult[3] || attrResult[4] || attrResult[5] || true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// 处理结束标签\r\n\t\t\tif (endResult) {\r\n\t\t\t\tadvance(endResult[0].length);\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log('解析开始标签的结果', match, htmlStr);\r\n\t\t\treturn match;\r\n\t\t}\r\n\r\n\t\treturn false; // 说明不是开始标签\r\n\t}\r\n\r\n\r\n\t// 开始循环解析htmlStr模板字符串 直至htmlStr为空\r\n\twhile (htmlStr) {\r\n\t\t/**\r\n\t\t * 如何确定父子关系：基于栈模拟标签的顺序关系\r\n\t\t * 1. 遇到一个开始标签div，就先压入栈底【div】\r\n\t\t * 2. 再遇到一个开始标签比如p，就再压入栈，此时栈底的div就是p的父元素 【div p】\r\n\t\t * 3. 遇到一个结束标签</p>,就和栈顶进行匹配 如果匹配ok 就从栈中弹出【div p p】\r\n\t\t * 4. 知道全部解析完成 栈清空 说明标签匹配完了 【】\r\n\t\t */\r\n\r\n\t\tlet textEnd = htmlStr.indexOf('<')\r\n\t\t\r\n\t\t// 1.textEnd值为0 代表解析到了一个开始标签<div>或者结束标签</div>\r\n\t\tif (textEnd === 0) {\r\n\t\t\t// 解析到的开始标签的匹配结果\r\n\t\t\tconst startTagMatch = parseStartTag();\r\n\t\t\tif (startTagMatch) {\r\n\t\t\t\tstart(startTagMatch.tagName, startTagMatch.attrs);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t// 解析到的是结束标签\r\n\t\t\tconst endTagMatch = htmlStr.match(endTag);\r\n\t\t\tif (endTagMatch) {\r\n\t\t\t\tadvance(endTagMatch[0].length);\r\n\t\t\t\tend(endTagMatch[1])\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// 2.textEnd值>0 代表解析到了文本结束的位置<div>文本</div>\r\n\t\tif (textEnd > 0) {\r\n\t\t\t// 解析到的文本结果\r\n\t\t\tlet text = htmlStr.slice(0, textEnd);\r\n\t\t\tif (text) {\r\n\t\t\t\tchars(text);\r\n\t\t\t\tadvance(text.length);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconsole.log('root', root);\r\n\treturn root;\r\n}\n","import {\r\n\tparseHTML,\r\n\tELEMENT_TYPE,\r\n\tTEXT_TYPE\r\n} from './htmlParser.js'\r\n\r\nimport {\r\n\tdefaultTagReg\r\n} from './tagRegs.js'\r\n/**\r\n * Vue 2.0 模板编译\r\n * @param {Object} template 需要被编译的模板\r\n * @return {function} render 生成的render方法\r\n * \r\n * 1. 将传入的template转化成为AST抽象语法树\r\n * 2. 生成render方法\r\n * 3. 执行render方法的返回值就是虚拟DOM\r\n * 4. 将虚拟DOM转化为真实DOM\r\n */\r\nexport function compileToFunction(template) {\r\n\t/*\r\n\t\t第一步：生成AST抽象语法树\r\n\t\t{\r\n\t\t\ttag:\"div\",\r\n\t\t\ttype:1,\r\n\t\t\tattrs:[{name:'lilei',age:'18'}],\r\n\t\t\tparent:null,\r\n\t\t\tchildren:[\r\n\t\t\t\t{\r\n\t\t\t\t\ttag:\"div\",\r\n\t\t\t\t\ttype:1,\r\n\t\t\t\t\tattrs:[{name:'lilei',age:'18'}],\r\n\t\t\t\t\tparent:,\r\n\t\t\t\t\tchildren:[...]\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t*/\r\n\tlet ast = parseHTML(template);\r\n\r\n\t/* \r\n\t\t第二步：基于ast语法树拼接生成需要的代码字符串\r\n\t\trender方法，render方法执行后返回的结果就是虚拟DOM\r\n\t\t实现c v s函数\r\n\t */\r\n\tlet code = codeGenerator(ast);\r\n\t\r\n\tcode = `with(this){\r\n\t\treturn ${code};\r\n\t}`\r\n\t\r\n\t\r\n\t\r\n\t/* \r\n\t\t第三步：如何将代码字符串执行呢\r\n\t\tnew Function语法：\r\n\t\t只传递一个参数，那么会返回一个匿名的函数，函数体就是参数\r\n\t\tnew Function(functionBody)\r\n\t\t\r\n\t\t传递多个参数，前面的参数都是函数的形参，最后一个参数是函数体\r\n\t\tnew Function(arg0, functionBody)\r\n\t\tnew Function(arg0, arg1, functionBody)\r\n\t\tnew Function(arg0, arg1, ..., argN, functionBody)\r\n\t\t\r\n\t\tnew Funtion生成的函数只能在全局作用域中运行，在调用该函数的时候只能访问全局变量和自己局部变量\r\n\t\tlet x = 100;\r\n\t\tfunction demo(){\r\n\t\t\tlet x = 100;\r\n\t\t\treturn new Function('console.log(x)')\r\n\t\t}\r\n\t\t\r\n\t\tlet f = demo();\r\n\t\tf();// 100 因为只能访问全局的变量\r\n\t\t\r\n\t */\r\n\t\r\n\tlet render = new Function(code);\r\n\tconsole.log('render函数',render)\r\n\t\r\n\t/* 执行render函数 用call绑定this */\r\n\r\n\t// render() {\r\n\t// \treturn _c('div', {\r\n\t// \t\tid: 'app'\r\n\t// \t}, _c('div', {\r\n\t// \t\tstyle: {\r\n\t// \t\t\tcolor: 'red'\r\n\t// \t\t}\r\n\t// \t}, _v('姓名：' + _s(name)),_c('p',null,_v('年龄：' + _s(age)))))\r\n\t// }\r\n\t// c创建元素的 v创建文本的 s是stringify\r\n\r\n\treturn render;\r\n\r\n}\r\n\r\nfunction codeGenerator(astNode) {\r\n\t// let attrsCode = generatorProps(astNode.attrs);\r\n\tlet childrenCode = generatorChildren(astNode.children);\r\n\tconsole.log('childrenCode',childrenCode);\r\n\tlet code =\r\n\t\t`_c('${astNode.tag}',${ astNode.attrs.length ? generatorProps(astNode.attrs):'null'}${ astNode.children.length ? `,${childrenCode}`:''})`;\r\n\r\n\tconsole.log('code', code);\r\n\treturn code;\r\n}\r\n\r\nfunction generatorChildren(children) {\r\n\tif(children){\r\n\t\treturn children.map(child => generatorChild(child)).join(',')\r\n\t}\r\n}\r\n\r\nfunction generatorChild(astNode) {\r\n\r\n\t// 元素 生成元素\r\n\tif (astNode.type === ELEMENT_TYPE) {\r\n\t\treturn codeGenerator(astNode);\r\n\t}\r\n\r\n\t// 文本 创建文本\r\n\t/**\r\n\t * 1. 纯文本\r\n\t * eg:hahah ===> re:`_v(hahah)`\r\n\t * \r\n\t * 2. {{name}}\r\n\t * 3. {{name}} + '纯文本' + {{age}}\r\n\t * \r\n\t * eg:{{name}} hahah {{ age}} ===> re:`_v(_s(name) + hahah + _s(age))`\r\n\t * \r\n\t */\r\n\tif (astNode.type === TEXT_TYPE) {\r\n\t\tlet text = astNode.text;\r\n\t\tif (!defaultTagReg.test(text)) {\r\n\t\t\t// 说明是纯文本\r\n\t\t\treturn `_v(${JSON.stringify(text)})`\r\n\t\t} else {\r\n\t\t\t// 说明文本中包含一个或多个表达式文本\r\n\t\t\tlet tokens = [];\r\n\t\t\tlet match;\r\n\t\t\tlet lastIndex = 0;\r\n\t\t\t// 重置下正则的lastIndex属性为0\r\n\t\t\tdefaultTagReg.lastIndex = 0;\r\n\t\t\twhile (match = defaultTagReg.exec(text)) {\r\n\t\t\t\t// 获取当前这一次匹配到{{}}开始的位置\r\n\t\t\t\tlet index = match.index;\r\n\t\t\t\tif (index - lastIndex > 0) {\r\n\t\t\t\t\ttokens.push(JSON.stringify(text.slice(lastIndex, index)));\r\n\t\t\t\t}\r\n\t\t\t\ttokens.push(`_s(${match[1].trim()})`)\r\n\t\t\t\t// 更新lastIndex 便于截取两个{{}}之间的字符 \r\n\t\t\t\tlastIndex = index + match[0].length;\r\n\t\t\t}\r\n\t\t\tif (lastIndex < text.length) {\r\n\t\t\t\ttokens.push(JSON.stringify(text.slice(lastIndex, text.length)));\r\n\t\t\t}\r\n\t\t\tconsole.log('tokens', tokens);\r\n\t\t\treturn `_v(${tokens.join('+')})`\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nfunction generatorProps(attrs) {\r\n\tif (attrs.length === 0) return 'null'\r\n\r\n\tlet propsStr = '';\r\n\tfor (let attr of attrs) {\r\n\t\tlet key = attr.name;\r\n\t\tlet value = attr.value;\r\n\r\n\t\t// 当属性的key是style的时候 需要特殊处理value为对象\r\n\t\tif (key === 'style') {\r\n\t\t\tlet styleObj = {};\r\n\r\n\t\t\tif (value[value.length - 1] === ';') {\r\n\t\t\t\tvalue = value.slice(0, -1);\r\n\t\t\t}\r\n\r\n\t\t\tvalue.split(';').forEach(item => {\r\n\t\t\t\tlet [k, v] = item.split(':');\r\n\t\t\t\tstyleObj[k] = v;\r\n\t\t\t})\r\n\t\t\tvalue = styleObj;\r\n\t\t}\r\n\r\n\t\t// 不同属性间用逗号隔开 id:100,name:'lilei'\r\n\t\tpropsStr += `${key}:${JSON.stringify(value)},`;\r\n\t}\r\n\t// 循环结束之后末尾会多一个逗号,\r\n\treturn `{${propsStr.slice(0,-1)}}`;\r\n}\n","let timerFunction;\r\nfunction getTimerFn(fn){\r\n\tif(Promise){\r\n\t\ttimerFunction = ()=>{\r\n\t\t\tPromise.resolve().then(flashCallBacks);\r\n\t\t}\r\n\t}else if(MutationObserver){\r\n\t\t// 这里传入的回调是异步回调 当DOM元素变化的时候触发\r\n\t\tlet mutationOb = new MutationObserver(flashCallBacks);\r\n\t\t\r\n\t\tlet textNode = document.createTextNode(1);\r\n\t\tmutationOb.observe(textNode,{\r\n\t\t\tcharacterData:true\r\n\t\t})\r\n\t\ttimerFunction = ()=>{\r\n\t\t\ttextNode.textContent = 2;\r\n\t\t}\r\n\t}else if(setImmediate){\r\n\t\ttimerFunction = ()=>{\r\n\t\t\tsetImmediate(flashCallBacks);\r\n\t\t}\r\n\t}else{\r\n\t\ttimerFunction = ()=>{\r\n\t\t\tsetTimeout(flashCallBacks);\r\n\t\t}\r\n\t}\r\n}\r\ngetTimerFn();\r\n\r\n/**\r\n * @param {Object} callback 回调函数\r\n * 异步批处理:多次操作执行一次\r\n */\r\nlet callBacks = [];\r\nlet waiting = false;\r\n\r\nfunction flashCallBacks(){\r\n\tlet flushCallBacks = callBacks.slice(0);\r\n\t\r\n\t// 清空队列和memo对象以及pending默认值\r\n\tcallBacks = [];\r\n\twaiting = false\r\n\t\r\n\t// 从保存watcher的队列中依次取出更新视图\r\n\tflushCallBacks.forEach(cb=>{\r\n\t\tcb();\r\n\t});\r\n}\r\n\r\nexport function nextTick(callback){\r\n\t// 维护所有来自内部和外部的callback 这是同步操作\r\n\tcallBacks.push(callback);\r\n\t\r\n\tif(!waiting){\r\n\t\t// 这是异步操作\r\n\t\ttimerFunction();\r\n\t\twaiting = true;\r\n\t}\r\n}\r\n\r\n","import Dep from './dep.js'\r\nimport { nextTick } from './nextTick.js';\r\n\r\nlet id = 0;\r\nclass Watcher {\r\n\t/**\r\n\t * @param {Object} vm 实例\r\n\t * @param {Object} fn 实例对应的渲染逻辑\r\n\t * @param {Object} flag 标识是否为渲染watcher\r\n\t */\r\n\tconstructor(vm, fn, flag) {\r\n\t\tthis.id = id++; // 创建组件唯一的watcher\r\n\t\tthis.getter = fn; // getter意味着调用函数可以发生取值操作\r\n\t\tthis.renderWatcher = flag; // 标识是否为渲染watcher\r\n\t\t\r\n\t\t/**\r\n\t\t * 记录当前这个组件watcher实例上观察了多少个属性，目的：\r\n\t\t * 1.实现computed计算属性\r\n\t\t * 2.组件卸载之后需要将当前组件watcher绑定的所有dep释放\r\n\t\t * 3.watcher和dep是多对多的关系\r\n\t\t */\r\n\t\tthis.deps = []; \r\n\t\t\r\n\t\t// 记录当前watcher绑定的dep的id数组 实现去重操作\r\n\t\tthis.depsId = new Set();\r\n\t\t\r\n\t\t// 每次new Watcher 会执行并渲染视图\r\n\t\tthis.get();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {Object} dep 属性的收集器\r\n\t * 给watcher记录关联了多少个属性dep\r\n\t * \r\n\t * 注意：重复的属性也不用重复push记录，因为一个watcher组件模板中可能绑定了多个重复的属性，比如一个组件模板多个地方用到属性name这是很常见的\r\n\t */\r\n\taddDep(dep){\r\n\t\tlet depId = dep.id;\r\n\t\t// 使用set实现watcher关联的属性dep 去重 避免同一属性重复watcher重复关联\r\n\t\tif(!this.depsId.has(depId)){\r\n\t\t\t\r\n\t\t\t// 先让watcher记住其关联的dep\r\n\t\t\tthis.deps.push(dep);\r\n\t\t\t\r\n\t\t\t// 为了下次depsId可以进行去重判断\r\n\t\t\tthis.depsId.add(depId);\r\n\t\t\t\r\n\t\t\t// 最后才让dep记住其关联的watcher 这个this是watcher\r\n\t\t\tdep.addSub(this);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\r\n\tget() {\r\n\t\t// 给Dep类的静态属性target赋值\r\n\t\tDep.target = this;\r\n\r\n\t\t/**\r\n\t\t * 1.执行getter就等于执行组件new Watcher的时候传递进来的渲染逻辑函数中的_render\r\n\t\t * 2.就等于执行$options.render.call(vm)\r\n\t\t * 3.就等于去vm上获取模板中变量vm.name和vm.age的值\r\n\t\t * 4.就会触发绑定在模板上属性defineProperty的get方法\r\n\t\t */\r\n\t\tthis.getter();\r\n\t\t\r\n\t\t// 渲染完成之后将Dep.target设置为null\r\n\t\tDep.target = null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * watcher组件更新视图 \r\n\t * 如果同一个组件A模板中绑定的name和age属性值都发生了set操作\r\n\t * 那么原本直接执行watcher的get方法会触发两次视图渲染\r\n\t * 这里设计一个队列将watcher都缓存起来 只更新一次 避免性能浪费\r\n\t */\r\n\tupdate(){\r\n\t\t// watcher去重并将其放入队列\r\n\t\tqueneWatcher(this);\r\n\t}\r\n\t\r\n\trun(){\r\n\t\t// 真正执行视图渲染的地方\r\n\t\tthis.get();\r\n\t}\r\n}\r\n\r\n\r\n\r\nlet quene = [];\r\nlet memo = {};\r\nlet pending = false;\r\n\r\n/**\r\n * 1. 同一组件watcher多个属性set引起的watcher去重\r\n * 2. 多个组件的属性同时发生变化 保证只更新一次视图\r\n */\r\nfunction queneWatcher(watcher){\r\n\tconst watcherId = watcher.id;\r\n\t\r\n\t// watcher去重\r\n\tif(!memo[watcherId]){\r\n\t\tquene.push(watcher);\r\n\t\tmemo[watcherId] = true;\r\n\t\tconsole.log(quene);\r\n\t\t\r\n\t\t// 不管此方法执行多少次 最终的视图刷新操作只执行一次\r\n\t\tif(!pending){\r\n\t\t\t// setTimeout(flushSchedulerQuene,0)\r\n\t\t\tnextTick(flushSchedulerQuene,0);\r\n\t\t\tpending = true;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * 更新视图操作\r\n */\r\nfunction flushSchedulerQuene(){\r\n\tconsole.log('执行异步批量渲染');\r\n\t// 浅克隆一份\r\n\tlet flushWatcherQuene = quene.slice(0);\r\n\t\r\n\t// 清空队列和memo对象以及pending默认值\r\n\tquene = [];\r\n\tmemo = {};\r\n\tpending = false\r\n\t\r\n\t// 从保存watcher的队列中依次取出更新视图\r\n\tflushWatcherQuene.forEach(watcher=>{\r\n\t\twatcher.run();\r\n\t});\r\n}\r\n\r\n\r\nexport default Watcher;\n","import Watcher from '../observer/watcher.js';\r\n\r\n/**\r\n * 组件挂载流程\r\n * @param {Object} vm 挂载组件所需的Vue实例对象\r\n * @param {Object} el 组件所在的DOM元素对象\r\n */\r\nexport function mountComponent(vm, el) {\r\n\r\n\t/**\r\n\t * 1. 调用render方法产生虚拟节点 -虚拟DOM => vm._render()\r\n\t * 2. 根据虚拟DOM生成真实DOM \r\n\t * 3. 用新的真实DOM替换el DOM元素\r\n\t */\r\n\r\n\tvm.$el = el; // 方便在实例调用_update的时候直接通过$el属性取值\r\n\r\n\r\n\t// 定义渲染逻辑函数 每次执行这个函数就会对组件进行重新渲染\r\n\tlet updateComponent = ()=>{\r\n\t\tvm._update(vm._render());\r\n\t}\r\n\t\r\n\t// 创建watcher new的过程就是渲染视图的过程\r\n\tlet watcher = new Watcher(vm,updateComponent,true);\r\n\tconsole.log('watcher',watcher)\r\n\t\r\n}\n","import {\r\n\tinitState\r\n} from './initState.js';\r\nimport {\r\n\tcompileToFunction\r\n} from '../template-compiler/index.js'\r\n\r\nimport {mountComponent} from '../lifecycle/index.js'\r\n\r\nexport function initMixin(Vue) {\r\n\t/* 在这里给Vue原型拓展方法 */\r\n\tVue.prototype._init = function(options) {\r\n\r\n\t\t// 给生成的实例上挂载$options用于在其他地方获取用户传入的配置\r\n\t\tlet vm = this;\r\n\t\tvm.$options = options;\r\n\r\n\t\t// 开始初始化options中的各个状态 data - props - methods...\r\n\t\tinitState(vm);\r\n\r\n\t\t// 如果用户传入了el属性 就使用$mount进行挂载\r\n\t\tif (options.el) {\r\n\t\t\tvm.$mount(options.el);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tVue.prototype.$mount = function(el) {\r\n\t\tlet vm = this;\r\n\t\tlet options = vm.$options;\r\n\t\tlet element = document.querySelector(el);\r\n\r\n\t\t/* 编译模板优先级 render - template - el */\r\n\t\tif (!options.render) {\r\n\t\t\tlet template;\r\n\t\t\t// 如果没有传递template属性但是有element\r\n\t\t\tif (!options.template && element) {\r\n\t\t\t\ttemplate = element.outerHTML;\r\n\t\t\t} else {\r\n\t\t\t\t// 如果template属性和element属性都有 这里的判断没有考虑太完全\r\n\t\t\t\ttemplate = options.template;\r\n\t\t\t}\r\n\t\t\t// 获取到模板template 就需要对模板进行编译 输入template 输出render函数\r\n\t\t\tif (template) {\r\n\t\t\t\tconst render = compileToFunction(template);\r\n\t\t\t\toptions.render = render;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// 组件的挂载：将实例vm对象挂载到DOM元素el上面\r\n\t\t// vm.$options中可以获取前面生成的render函数\r\n\t\tmountComponent(vm,element);\r\n\r\n\t}\r\n\r\n}\n","\r\n/**\r\n * 创建虚拟DOM 元素节点\r\n * h方法和_c都是这个方法\r\n */\r\nexport function createElementVNode(vm,tag,data,...children){\r\n\tif(data == null) {\r\n\t\tdata = {};\r\n\t}\r\n\tlet key = data.key;\r\n\tif(key){\r\n\t\tdelete data.key;\r\n\t}\r\n\treturn createVNode(vm,tag,key,data,children)\r\n}\r\n\r\n\r\n/**\r\n * 创建虚拟DOM 文本节点\r\n * _v就是这个方法\r\n */\r\nexport function createTextVNode(vm,text,props={},...children){\r\n\treturn createVNode(vm,null,null,null,null,text)\r\n}\r\n\r\n/**\r\n * 1.描述的是语法还是DOM \r\n * 2. 能不能在过程中自定义新的内容进去\r\n * 3. react 把JSX转化为AST Vue是吧template转化为AST 都是语法层面的转化\r\n * \r\n * AST做的是将HTML模板转化为一颗JS树的对象，做的是语法层面的转化，不能放自定义的属性，html标签是什么样子就转化为什么样，AST还可以描述css、es6语法、jsx等，描述的是语言本身\r\n * \r\n * \r\n * 虚拟DOM做的是描述DOM元素，可以增加一些自定义的属性，比如vm属性，插槽，指令等，核心是更加好的描述DOM元素\r\n * @param {Object} vm\r\n * @param {Object} tag\r\n * @param {Object} key\r\n * @param {Object} props\r\n * @param {Object} children\r\n * @param {Object} text\r\n * \r\n */\r\nfunction createVNode(vm,tag,key,data,children,text){\r\n\treturn {\r\n\t\tvm,\r\n\t\ttag,\r\n\t\tkey,\r\n\t\tdata,\r\n\t\tchildren,\r\n\t\ttext\r\n\t}\r\n}\r\n\r\n","import {createElementVNode,createTextVNode} from '../vNode/index.js'\r\n\r\n/**\r\n * 1. 初始化渲染\r\n * 2. 异步更新diff算法\r\n * patch是更新的意思\r\n */\r\nfunction patch(oldVNode,VNode){\r\n\t// 如果oldVNode是一个真实的DOM元素 那么代表传递进来的是要挂载的DOM节点 是初始化渲染\r\n\tlet isRealDomElement = oldVNode.nodeType;\r\n\tif(isRealDomElement){\r\n\t\t// 开始初始化渲染\r\n\t\t\r\n\t\t// 1.基于VNode虚拟DOM创建真实DOM元素\r\n\t\tlet newElement = createElement(VNode);\r\n\t\tconsole.log('newElement',newElement)\r\n\t\t\r\n\t\t// 2.新节点newElement替换老节点el 也是有讲究的\r\n\t\t// 假设要将A节点的内容替换为B节点的，需要先将B插入到A的下一个兄弟节点位置，然后移除A节点；而不能直接先将A移除，然后找到A的父元素appendChild，这样会插入到A的父元素的末尾去，导致前后节点位置发生变化\r\n\t\tlet parentNode = oldVNode.parentNode;\r\n\t\tparentNode.insertBefore(newElement,oldVNode.nextSibling)\r\n\t\tparentNode.removeChild(oldVNode);\r\n\t\t\r\n\t\t// 3. 返回新的DOM\r\n\t\treturn newElement;\r\n\t\t\r\n\t}else{\r\n\t\t// 开始diff算法对比\r\n\t\t\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {Object} VNode\r\n * 根据虚拟DOM节点创建真实DOM节点\r\n * 这个真实的DOM节点就是最终要替代传入的el节点的元素节点\r\n */\r\nfunction createElement(VNode){\r\n\tlet {tag,data,children,text} = VNode;\r\n\t// 在_render方法生成虚拟DOM节点的时候设置了如果tag是一个字符串，那么就是元素节点；如果是null就是文本节点\r\n\tif(typeof tag === 'string'){\r\n\t\t// 将虚拟DOM和新建的真实DOM联系起来\r\n\t\tVNode.el = document.createElement(tag);\r\n\t\t// 给新DOM节点的属性赋值\r\n\t\tpatchProps(data,VNode.el)\r\n\t\t// 给新DOM节点的children赋值\r\n\t\tchildren.forEach(child=>{\r\n\t\t\tVNode.el.appendChild(createElement(child));\r\n\t\t})\r\n\t}else {\r\n\t\t// 创建文本节点\r\n\t\tVNode.el = document.createTextNode(text);\r\n\t}\r\n\t\r\n\treturn VNode.el;\r\n}\r\n\r\n/**\r\n * @param {Object} props 属性组成的对象\r\n * @param {Object} el 当前属性要挂载的元素节点\r\n * props:{ id:'app',style:{ color:red}}\r\n */\r\nfunction patchProps(props,el){\r\n\tfor(let key in props){\r\n\t\tif(key === 'style'){\r\n\t\t\t// 再次从style对象中取值 给el的style赋值\r\n\t\t\tfor (let styleProp in props.style) {\r\n\t\t\t\tel.style[styleProp] = props.style[styleProp];\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tel.setAttribute(key,props[key]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nexport function initLifeCycle(Vue){\r\n\t\r\n\t/* 渲染虚拟DOM */\r\n\tVue.prototype._render = function(){\r\n\t\tconst vm = this;\r\n\t\t// 让with里面的this指向vm实例，就可以去实例中取值\r\n\t\t// 这一步就可以将属性和视图进行挂钩\r\n\t\treturn vm.$options.render.call(vm);\r\n\t}\r\n\t\r\n\t// 生成元素节点\r\n\tVue.prototype._c = function(){\r\n\t\treturn createElementVNode(this,...arguments);\r\n\t}\r\n\t\r\n\t// 生成文本节点\r\n\tVue.prototype._v = function(){\r\n\t\treturn createTextVNode(this,...arguments);\r\n\t}\r\n\t\r\n\t// 转义字符串\r\n\tVue.prototype._s = function(value){\r\n\t\t// 不是对象类型的话 没必要转义\r\n\t\tif(typeof value !== 'object') return value;\r\n\t\treturn JSON.stringify(value);\r\n\t}\r\n\t\r\n\t\r\n\t/* 转化真实DOM */\r\n\tVue.prototype._update = function(vNode){\r\n\t\t\r\n\t\tconst vm = this;\r\n\t\tconst el = vm.$el; // 此el是querySelector获取到的dom元素对象，不是new Vue时传入的选择符字符串'#app'\r\n\t\t\r\n\t\tconsole.log('执行render函数返回的虚拟节点',vNode);\r\n\t\tconsole.log('要挂载的真实DOM节点',el);\r\n\t\t\r\n\t\t/**\r\n\t\t * Vue2.0和Vue3.0\r\n\t\t * patch既有初始化的功能，又有更新视图的功能\r\n\t\t * 将虚拟DOM转化为真实DOM\r\n\t\t * \r\n\t\t * 用vNode创建真实DOM节点，然后替换到原来的el元素节点\r\n\t\t * 并将patch后的返回值也就是新的真实DOM节点赋值给实例的$el属性\r\n\t\t * 为了下一次更新的时候老的el就是上一次生成的真实DOM节点\r\n\t\t */\r\n\t\tvm.$el = patch(el,vNode);\r\n\t}\r\n}","/* 打包入口文件 */\r\nimport {initMixin} from './init/init.js';\r\nimport {initLifeCycle} from './lifecycle/initLifeCycle.js'\r\nimport { nextTick } from './observer/nextTick.js';\r\n\r\n// Vue构造函数\r\nfunction Vue(options){\r\n\tthis._init(options);\r\n}\r\n\r\n// 原型挂载核心API \r\nVue.prototype.$nextTick = nextTick;\r\n\r\n// 给Vue类拓展初始化options的方法\r\ninitMixin(Vue);\r\n\r\n// 模板编译 组件挂载\r\ninitLifeCycle(Vue);\r\n\r\n\r\nexport default Vue; "],"names":["id","Dep","subs","watcher","addDep","push","forEach","update","target","observe","data","__ob__","Observer","Object","defineProperty","value","enumrable","configurable","Array","isArray","newArrayProto","createNewArrayProto","__proto__","observeArray","walk","keys","key","defineReactive","item","dep","get","console","log","depend","set","newValue","notify","oldArrayProto","prototype","create","methods","method","args","result","call","inserted","slice","proxy","vm","initData","$options","_data","initState","options","props","initProps","initMethods","computed","initComputed","watch","initWatch","ncname","qnameCapture","startTagOpen","RegExp","startTagClose","endTag","attribute","defaultTagReg","ELEMENT_TYPE","TEXT_TYPE","parseHTML","htmlStr","stack","currentParent","root","createASTElement","tag","attrs","type","parent","children","start","tagName","astNode","end","pop","error","length","chars","text","replace","advance","n","parseStartTag","match","attrResult","endResult","name","textEnd","indexOf","startTagMatch","endTagMatch","compileToFunction","template","ast","code","codeGenerator","render","Function","childrenCode","generatorChildren","generatorProps","map","child","generatorChild","join","test","JSON","stringify","tokens","lastIndex","exec","index","trim","propsStr","attr","styleObj","split","k","v","timerFunction","getTimerFn","fn","Promise","resolve","then","flashCallBacks","MutationObserver","mutationOb","textNode","document","createTextNode","characterData","textContent","setImmediate","setTimeout","callBacks","waiting","flushCallBacks","cb","nextTick","callback","Watcher","flag","getter","renderWatcher","deps","depsId","Set","depId","has","add","addSub","queneWatcher","quene","memo","pending","watcherId","flushSchedulerQuene","flushWatcherQuene","run","mountComponent","el","$el","updateComponent","_update","_render","initMixin","Vue","_init","$mount","element","querySelector","outerHTML","createElementVNode","createVNode","createTextVNode","patch","oldVNode","VNode","isRealDomElement","nodeType","newElement","createElement","parentNode","insertBefore","nextSibling","removeChild","patchProps","appendChild","styleProp","style","setAttribute","initLifeCycle","_c","arguments","_v","_s","vNode","$nextTick"],"mappings":"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"}